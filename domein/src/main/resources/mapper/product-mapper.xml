<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="product">
		
		<insert parameterType="boardProductSaleContent" id="insertBoardSContent">
			insert into BOARD_DIRECT_SALE values(SEQ_article_No.nextval,
			#{title},
			#{businessKey},
			SYSDATE,
			SYSDATE,
			#{saleContent},
			default,
			'1'	
			)
	<!-- 	<selectKey order="AFTER" resultType="_int" keyProperty="aticleNo">
				SELECT SEQ_article_No.CURRVAL FROM DUAL
			</selectKey> -->
	<!-- 		<selectKey order="BEFORE" resultType="_int" keyProperty="businessKey">
				select b.business_key from business b, member m where  m.member_key=b.business_key
			</selectKey> -->
		</insert>
		
		<insert parameterType="product" id="insertProduct">
			INSERT INTO DIRECT_SALE_PRODUCT VALUES(SEQ_PRODUCT_NO.NEXTVAL,
			#{productName},
			#{productQuality},
			#{origin},
			#{productQuantity},
			#{measureUnit},
			#{price},
			#{remaningQuantity},
			#{articleNo},
			${productStatusNo} 
			) 
				<!-- 시작전에 artcleno를 가져오기위한 outjoin문 -->
				<selectKey order="AFTER" resultType="_int" keyProperty="productNo">
					SELECT SEQ_PRODUCT_NO.CURRVAL FROM DUAL
				</selectKey>
		</insert> 
		
		<insert parameterType="attachement" id="insertAttachement">
			INSERT INTO BDS_ATTACHED_IMAGE VALUES(#{productNo},
			${product_image_No},
			#{origin_File_name},
			#{renamed_File_name}
			)
		 </insert> 
		<!--  상품 aticle_no,title,product_no,price,p_renamed_file_name 3개테이블조인후 조회 -->
		 <select id="selectProductList" resultType="map">
				
				select p.*,(select count(*) from product_all WHERE P.PRODUCT_NO=PRODUCT_NO)as ATTAC from product_all p order by p.article_no desc
				<!-- select b.article_no,b.title,d.product_no,d.price,a.p_renamed_file_name,
				(select count(*) from DIRECT_SALE_PRODUCT WHERE d.product_no=a.product_no)
				as ATTCOUNT from BOARD_DIRECT_SALE b
				inner join DIRECT_SALE_PRODUCT d on b.article_no=d.article_no
				inner join BDS_ATTACHED_IMAGE a 
				on d.product_no=a.product_no -->
		 
		 </select>
		<!--   상품목록카운트-->
		 <select id="selectCount" resultType="_int">
		 	select count(*) from BOARD_DIRECT_SALE
		 </select>
		
</mapper>